% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/tabulate_cases.R
\name{tabulate_cases}
\alias{tabulate_cases}
\title{Tabulate annual cases_per_1000 vs a baseline year}
\usage{
tabulate_cases(
  con = NULL,
  raw_db_path = NULL,
  parameter_index = NULL,
  global_index = NULL,
  baseline_year,
  future_years,
  stochastic_average = TRUE,
  output_dir = NULL,
  table_name = "simulation_results",
  days_per_year = 365
)
}
\arguments{
\item{con}{Optional DuckDB connection object. If provided, \code{raw_db_path} is ignored.}

\item{raw_db_path}{Path to the .duckdb file. Required if \code{con} is not provided.}

\item{parameter_index}{Integer (optional). One of \code{parameter_index} OR \code{global_index} must be provided.}

\item{global_index}{Character (optional). One of \code{parameter_index} OR \code{global_index} must be provided.}

\item{baseline_year}{Integer (>= 0). Year used as the baseline (e.g., 2 means days [2\emph{365, 3}365)).}

\item{future_years}{Integer vector. Years strictly greater than \code{baseline_year}
(e.g., c(4,5,6)). Any years <= baseline are dropped with a warning.}

\item{stochastic_average}{Logical. If TRUE (default), average across simulations for
each year using only simulations that have data for both the baseline and that
future year. If FALSE, return per-simulation rows.}

\item{output_dir}{Optional directory to write a CSV summary. If NULL/"" no file is written.}

\item{table_name}{Table name in DuckDB. Default "simulation_results".}

\item{days_per_year}{Numeric, default 365.}
}
\value{
If \code{stochastic_average = TRUE}: a data.frame with one row per future year and columns:
parameter_index, global_index, baseline_year, future_year, baseline_cases_per_1000,
future_cases_per_1000, delta_cases_per_1000, percent_change, n_sims_used.

If \code{stochastic_average = FALSE}: one row per (simulation_index, future_year) with the same
metrics plus \code{simulation_index}.

If \code{output_dir} is provided, a CSV is written and the function still returns the data.frame.
}
\description{
For a given parameter set (by \code{parameter_index} OR \code{global_index}), compute the
annual mean of \code{cases_per_1000} for a baseline year and one or more future years,
then report absolute and percent changes relative to baseline.

Windows are year-aligned as:
year y -> timesteps in [y*days_per_year, (y+1)*days_per_year)
(with timesteps assumed to start at 1).
}
